<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Miss√£o Empreendedora ‚Äì Decida com Coragem</title>
<meta name="description" content="Jogo gamificado sobre comportamento empreendedor e soft skills." />
<style>
  :root{
    --azul:#0b2a4a;
    --azul-2:#12375e;
    --laranja:#ff7a00;
    --laranja-2:#ffa24a;
    --branco:#ffffff;
    --cinza:#f3f5f7;
    --cinza-2:#d7dde3;
    --texto:#0d1b2a;
    --neutro:#748cab;
    --ok:#10b981;         /* Verde (Alto) */
    --warn-dark:#a16207;  /* Amarelo escuro (M√©dio) */
    --risk-dark:#7f1d1d;  /* Vermelho escuro (Baixo) */
    --radius:14px;
    --shadow:0 10px 30px rgba(11,42,74,0.15);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font:16px/1.5 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--texto);
    background:linear-gradient(180deg,#0b2a4a 0%,#0b2a4a 35%,#f6f9fc 35%,#f6f9fc 100%);
    overflow-x:hidden; /* evita scroll horizontal eventual no mobile */
  }
  .app{
    max-width:960px;
    margin: clamp(16px,4vh,40px) auto;
    padding: 0 16px 40px;
  }
  header{
    color:var(--branco);
    display:flex;align-items:center;gap:14px;margin-bottom:14px;
  }
  .logo{
    width:42px;height:42px;border-radius:10px;background:var(--laranja);
    display:grid;place-items:center;color:var(--branco);font-weight:800;box-shadow:var(--shadow)
  }
  .title h1{margin:0;font-size:1.4rem}
  .title p{margin:4px 0 0;color:#e2e8f0;font-size:.95rem}
  .card{
    background:var(--branco);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden
  }

  /* ======== HERO ======== */
  .hero{
    position:relative;
    height:340px;
    background:var(--azul-2);
    color:#fff;display:flex;align-items:end;
    padding:18px 20px;border-bottom:1px solid #0b2a4a20;
  }
  @media (min-width:860px){
    .hero{height:400px;}
  }
  .hero img{
    position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
    object-position:center center;
    opacity:.40;filter:saturate(.95) contrast(1.05);
    pointer-events:none;
  }
  .hero .badge{
    position:absolute;top:12px;left:12px;background:rgba(255,122,0,.95);color:#fff;padding:6px 10px;border-radius:999px;
    font-weight:700;box-shadow:0 6px 18px rgba(255,122,0,.35);font-size:.9rem
  }
  .hero h2{
    position:relative;margin:0;
    font-size:1.65rem;
    line-height:1.2;
    text-shadow:0 2px 10px rgba(0,0,0,.35)
  }

  .content{padding:18px 18px 6px}

  /* ======== Narrativa ======== */
  .narrativa{
    background:var(--cinza);border:1px solid var(--cinza-2);padding:16px;border-radius:12px;color:#1f2937;
    font-size:1.05rem;
  }

  .afirmativas{margin-top:14px;display:flex;flex-direction:column;gap:14px}
  .afirmativa{
    border:1px solid var(--cinza-2);border-radius:12px;padding:12px;background:#fff;transition:transform .2s ease, box-shadow .2s ease;
  }
  .afirmativa:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(18,55,94,.08)}
  .afirmativa p{margin:0 0 10px; overflow-wrap:anywhere;} /* ajuda a quebrar textos longos */

  /* ====== Escala ====== */
  .likert{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .scale{
    display:grid;grid-template-columns:repeat(5,1fr);
    gap:6px;
    flex:1;min-width:260px
  }
  .scale input{
    position:absolute;width:1px;height:1px;margin:-1px;padding:0;border:0;
    clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;
  }
  .scale label{
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    padding:8px 8px;
    border:1px solid var(--cinza-2);
    border-radius:8px;
    background:#fff;cursor:pointer;
    user-select:none;font-weight:700;color:#334155;transition:all .15s ease;
    min-height:44px;
    gap:4px;
    font-size:0.9rem;
    text-align:center;
  }
  .scale label span{line-height:1}
  .scale label small{
    position:static;
    font-weight:500;color:#64748b;font-size:.72rem;line-height:1.15;text-align:center;
    white-space:normal; word-break:break-word; /* quebra ‚ÄúConcordo totalmente‚Äù */
  }
  .scale input:checked + label{
    border-color:var(--laranja);
    background:linear-gradient(180deg,#fff 0%,#fff 35%,#fff0 100%), rgba(255,122,0,.08);
    box-shadow:0 0 0 3px rgba(255,122,0,.15) inset, 0 8px 18px rgba(255,122,0,.08);
    color:#0b2a4a
  }
  .scale input:focus-visible + label{
    outline:3px solid #ffb56b; outline-offset:2px;
  }

  .legenda { display:none !important; }

  .progress{ margin:14px 0 0;background:#e2e8f0;height:10px;border-radius:999px;overflow:hidden }
  .progress > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--laranja),#ff9d40);transition:width .4s ease}

  .footer{
    display:flex;justify-content:space-between;gap:10px;padding:14px;background:#fff;border-top:1px solid #e5e7eb;border-radius:0 0 var(--radius) var(--radius)
  }
  .btn{
    appearance:none;border:0;background:var(--azul);color:#fff;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer;
    display:inline-flex;align-items:center;gap:8px;box-shadow:0 10px 22px rgba(11,42,74,.2);transition:transform .15s ease, filter .15s ease;
    min-height:44px; /* altura uniforme */
  }
  .btn.secondary{background:#fff;color:var(--azul);border:1px solid var(--cinza-2);box-shadow:none}
  .btn.warn{background:var(--laranja)}
  .btn:disabled{opacity:.6;cursor:not-allowed;filter:grayscale(.2)}

  .fade-enter{opacity:0;transform:translateY(8px)}
  .fade-enter-active{opacity:1;transform:none;transition:all .35s ease}
  .fade-exit{opacity:1;transform:none}
  .fade-exit-active{opacity:0;transform:translateY(-8px);transition:all .25s ease}

  .feedback{padding:18px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;font-weight:700;margin:4px 6px 0 0}
  .pill.ok{background:#ecfdf5;color:#065f46;border:1px solid #a7f3d0}
  .pill.mid{background:#fff7ed;color:var(--warn-dark);border:1px solid #fed7aa}
  .pill.low{background:#fef2f2;color:var(--risk-dark);border:1px solid #fecaca}

  .feedback .stack { display:flex; flex-direction:column; gap:22px; }
  .grid{display:grid;grid-template-columns:1fr;gap:22px}
  @media (min-width:860px){ .grid{grid-template-columns:1fr 1fr} }
  .box{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px}

  .table-clean{ width:100%; border-collapse:separate; border-spacing:0 6px; }
  .table-clean thead th{ text-align:left; font-weight:800; color:#334155; font-size:.92rem; padding:6px 8px; }
  .table-clean tbody td{ background:#fff; padding:10px 8px; vertical-align:middle; }
  .table-clean tbody tr{ box-shadow:0 1px 0 #e5e7eb inset, 0 -1px 0 #e5e7eb inset; border-radius:8px; }

  .lvl{ display:inline-flex;align-items:center;font-weight:700;padding:4px 8px;border-radius:999px;font-size:.82rem }
  .lvl.ok{ background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; }
  .lvl.mid{ background:#fff7ed; color:var(--warn-dark); border:1px solid #fed7aa; }
  .lvl.low{ background:#fef2f2; color:var(--risk-dark); border:1px solid #fecaca; }

  .checklist li{margin:8px 0}

  /* Impress√£o */
  @media print{
    header, .footer, .progress, .btn, .logo { display:none !important; }
    body{background:#fff}
    .card{box-shadow:none;border:0}
  }

  /* ===== CAPA & INTRO ===== */
  .cover, .intro { display:flex;flex-direction:column;gap:16px;padding:18px;background:#fff; }
  .cover-hero{
    position:relative;height:260px;background:#0b2a4a;border-radius:12px;overflow:hidden;display:flex;align-items:flex-end;padding:18px;color:#fff
  }
  .cover-hero img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.35;pointer-events:none}
  .cover-title{position:relative}
  .cover-title h2{margin:0;font-size:1.8rem}
  .cover-title p{margin:6px 0 0;font-size:1.05rem;color:#e6edf5}

  .intro h3{margin:0 0 6px}
  .intro p{margin:6px 0}
  .intro ul{margin:6px 0 0 1.2rem}

  /* ====================== RESPONSIVIDADE ====================== */
  /* 1) Likert: empilha no mobile */
  @media (max-width: 640px){ .scale{ grid-template-columns: 1fr 1fr; } }
  @media (max-width: 520px){
    .likert{ gap:8px; align-items:stretch; }
    .scale{ grid-template-columns: 1fr; min-width:0; width:100%; }
    .scale label{ align-items:flex-start; text-align:left; padding:10px 12px; }
    .scale label small{ white-space:normal; word-break:break-word; }
  }
  @media (max-width: 420px){
    .scale label{ font-size:.88rem; }
    .scale label small{ font-size:.70rem; }
  }

  /* 2) Bot√µes: padroniza no mobile */
  .footer > div{ display:flex; gap:10px; flex-wrap:wrap; }
  @media (max-width:560px){
    .footer{ flex-direction:column; align-items:stretch; }
    .footer > div{ width:100%; }
    .footer .btn{ width:100%; justify-content:center; min-height:46px; }
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Miss√£o Empreendedora ‚Äì Decida com Coragem">
  <header>
    <div class="logo" aria-hidden="true">ME</div>
    <div class="title">
      <h1>Miss√£o Empreendedora ‚Äì Decida com Coragem</h1>
      <p>Comportamento Empreendedor e Soft Skills ‚Ä¢ UDA PUC Minas Virtual</p>
    </div>
  </header>

  <section id="root" class="card" aria-live="polite"></section>
</div>

<script>
/* =========================
   Dados do jogo (Cen√°rios)
   ========================= */

const PALETA = { azul:"#0b2a4a", laranja:"#ff7a00", branco:"#ffffff" };

// Fallback padr√£o de imagem (caso a original falhe)
const IMG_FALLBACK = "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&w=1600&q=80";

const cenarios = [
  {
    titulo: "Cen√°rio 1: A Reuni√£o Tensa",
    imagem: "https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=1600&q=80",
    narrativa: "Voc√™ √© convidado para uma reuni√£o de urg√™ncia. A startup onde trabalha enfrenta uma crise de comunica√ß√£o interna. O clima √© tenso e todos aguardam que voc√™ proponha uma solu√ß√£o. Um colega levanta a voz, outro silencia. Voc√™ sente a press√£o.",
    afirmativas: [
      { texto: "Tentei manter a calma e escutar com empatia cada colega antes de intervir.", objetivos: [3,4] },
      { texto: "Consegui articular minha fala de forma clara, mesmo sob press√£o emocional.", objetivos: [2,4,5] },
      { texto: "Avaliei como minha fala poderia impactar a motiva√ß√£o da equipe antes de responder.", objetivos: [3,4] },
    ]
  },
  {
    titulo: "Cen√°rio 2: A Escolha do S√≥cio",
    imagem: "https://images.unsplash.com/photo-1551836022-d5d88e9218df?auto=format&fit=crop&w=1600&q=80",
    narrativa: "Voc√™ precisa decidir entre dois s√≥cios com perfis muito diferentes: um √© tecnicamente brilhante, o outro √© mais sens√≠vel e √©tico, por√©m com menos resultados pr√°ticos at√© agora.",
    afirmativas: [
      { texto: "Priorizei a confian√ßa e a sinergia emocional, mesmo que isso implique em mais tempo para resultados.", objetivos: [2,3] },
      { texto: "Tentei pensar nos impactos da decis√£o para a cultura da empresa a m√©dio e longo prazo.", objetivos: [1,5] },
      { texto: "Considerei como essa decis√£o afetaria meu pr√≥prio equil√≠brio emocional e motiva√ß√£o para seguir empreendendo.", objetivos: [3,7] },
    ]
  },
  {
    titulo: "Cen√°rio 3: A Incerteza no Lan√ßamento",
    imagem: "https://images.unsplash.com/photo-1556761175-b413da4baf72?auto=format&fit=crop&w=1600&q=80",
    narrativa: "Voc√™ est√° prestes a lan√ßar um produto digital, mas uma nova tecnologia acaba de ser divulgada e pode tornar seu produto obsoleto. Sua equipe est√° dividida entre seguir ou adiar.",
    afirmativas: [
      { texto: "Fiz uma an√°lise r√°pida e emocionalmente equilibrada sobre os riscos envolvidos.", objetivos: [3,5] },
      { texto: "Pensei no bem-estar da equipe ao decidir n√£o impor minha decis√£o de forma autorit√°ria.", objetivos: [3,4] },
      { texto: "Revisitei meu prop√≥sito empreendedor para decidir o que fazia mais sentido a longo prazo.", objetivos: [1,7] },
    ]
  },
  {
    titulo: "Cen√°rio 4: A Cr√≠tica em P√∫blico",
    imagem: "https://images.unsplash.com/photo-1515187029135-18ee286d815b?auto=format&fit=crop&w=1600&q=80",
    narrativa: "Durante um evento de pitch, voc√™ √© duramente criticado por um avaliador. A plateia fica em sil√™ncio. Sua equipe te observa atentamente esperando sua rea√ß√£o.",
    afirmativas: [
      { texto: "Controlei minha rea√ß√£o imediata para evitar uma resposta impulsiva.", objetivos: [3,5] },
      { texto: "Aproveitei a cr√≠tica para refletir e reformular parte da proposta com serenidade.", objetivos: [2,3,6] },
      { texto: "Usei a situa√ß√£o como aprendizado coletivo para inspirar minha equipe ap√≥s o evento.", objetivos: [1,4] },
    ]
  },
  {
    titulo: "Cen√°rio 5: O Algoritmo Injusto",
    /* Imagem substitu√≠da por uma op√ß√£o est√°vel que remete a IA/chatbot */
    imagem: "https://images.unsplash.com/photo-1518779578993-ec3579fee39f?auto=format&fit=crop&w=1600&q=80",
    narrativa: "Seu sistema de automa√ß√£o de atendimento digital come√ßa a gerar reclama√ß√µes por respostas impessoais. Seu s√≥cio prop√µe manter o sistema assim para reduzir custos, mas voc√™ tem d√∫vidas √©ticas.",
    afirmativas: [
      { texto: "Considerei o impacto humano antes de apoiar o uso do sistema automatizado.", objetivos: [1,2] },
      { texto: "Sugeri alternativas tecnol√≥gicas mais alinhadas a um atendimento emp√°tico.", objetivos: [4,6] },
      { texto: "Refleti sobre como decis√µes tecnol√≥gicas podem enfraquecer a confian√ßa com o cliente.", objetivos: [1,6] },
    ]
  }
];

const objetivos = {
  1: "Fundamentos do comportamento empreendedor e cria√ß√£o de valor",
  2: "Import√¢ncia e aplica√ß√£o de soft skills no desempenho profissional",
  3: "Intelig√™ncia emocional aplicada √† lideran√ßa e gest√£o",
  4: "Comunica√ß√£o emp√°tica e assertiva em trabalho em equipe",
  5: "Decis√£o sob press√£o com aspectos emocionais e estrat√©gicos",
  6: "Soft skills para oportunidades e solu√ß√µes inovadoras",
  7: "Ferramentas de autoconhecimento e desenvolvimento pessoal/profissional",
};

// Estado & Persist√™ncia
const STORAGE_KEY = "missaoEmpreendedora_v3";
let estado = {
  etapa: 'capa', // 'capa' | 'intro' | 'jogo' | 'feedback'
  atual: 0, // √≠ndice do cen√°rio
  respostas: Array.from({length: cenarios.length}, () => [null, null, null]),
  finalizado: false,
  diag: null
};

function carregarEstado(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try{
    const data = JSON.parse(raw);
    if(Array.isArray(data.respostas)) estado.respostas = data.respostas;
    if(typeof data.atual === "number") estado.atual = Math.min(Math.max(0,data.atual), cenarios.length-1);
    if(typeof data.etapa === "string") estado.etapa = data.etapa;
    if(data.finalizado) estado.finalizado = true;
    if(data.diag) estado.diag = data.diag;

    if(estado.finalizado) estado.etapa = 'feedback';
    else if(!['capa','intro','jogo'].includes(estado.etapa)) estado.etapa = 'capa';
  }catch(e){}
}
function salvarEstado(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(estado));
}
carregarEstado();

/* ======================
   Auto-resize para iframe
   ====================== */
function docHeight(){
  const b=document.body, d=document.documentElement;
  return Math.max(b.scrollHeight,d.scrollHeight,b.offsetHeight,d.offsetHeight,b.clientHeight,d.clientHeight);
}
function sendHeightToParent(){
  if (window.parent && window.parent !== window) {
    window.parent.postMessage({ type: 'me:height', value: docHeight() }, '*');
  }
}
(function(){
  if (!(window.parent && window.parent !== window)) return;
  const ro = new ResizeObserver(()=>requestAnimationFrame(sendHeightToParent));
  ro.observe(document.documentElement);
  window.addEventListener('load', sendHeightToParent);
  window.addEventListener('resize', ()=>requestAnimationFrame(sendHeightToParent));
  window.addEventListener('orientationchange', sendHeightToParent);
  window.addEventListener('message', (e)=>{
    if (e.data && e.data.type === 'me:ping') sendHeightToParent();
  });
})();

/* ==============
   Renderiza√ß√£o
   ============== */
const root = document.getElementById("root");
function $(sel, ctx=document){ return ctx.querySelector(sel); }

function animateSwap(html){
  const node = document.createElement("div");
  node.innerHTML = html;
  const next = node.firstElementChild;
  if(!root.firstChild){
    root.appendChild(next);
    requestAnimationFrame(()=>next.classList.add("fade-enter-active"));
    requestAnimationFrame(sendHeightToParent); // informa o host
    return;
  }
  const current = root.firstChild;
  current.classList.add("fade-exit-active");
  setTimeout(()=>{
    root.replaceChildren(next);
    next.classList.add("fade-enter");
    requestAnimationFrame(()=>{
      next.classList.add("fade-enter-active");
      next.classList.remove("fade-enter");
      requestAnimationFrame(sendHeightToParent); // informa o host
    });
  }, 200);
}

/* ====== CAPA ====== */
function renderCapa(){
  const html = `
    <section class="view-capa">
      <div class="cover">
        <div class="cover-hero" role="img" aria-label="Capa do jogo Miss√£o Empreendedora">
          <img src="https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=1600&q=80"
               alt="" onerror="this.onerror=null;this.src='${IMG_FALLBACK}'" />
          <div class="cover-title">
            <h2>Miss√£o Empreendedora</h2>
            <p>Descobrir seu perfil empreendedor</p>
          </div>
        </div>
        <p>Bem-vindo(a)! Este jogo foi pensado para voc√™ vivenciar desafios do comportamento empreendedor em um ambiente seguro e reflexivo.</p>
      </div>
      <div class="footer">
        <div></div>
        <div>
          <button class="btn" id="btn-comecar" type="button">Come√ßar</button>
        </div>
      </div>
    </section>
  `;
  animateSwap(html);
}

/* ====== INTRODU√á√ÉO ====== */
function renderIntro(){
  const texto = `
  <p>Voc√™ est√° prestes a entrar em uma experi√™ncia imersiva, onde cada escolha conta e cada decis√£o revela um pouco mais sobre o seu pr√≥prio empreendedor.</p>
  <p>No O jogo Miss√£o empreendedora, voc√™ encontrar√° cinco cen√°rios com situa√ß√µes reais do mundo empreendedor: dilemas, tens√µes, oportunidades, conflitos e momentos de decis√£o sob press√£o. Para cen√°rio, ter√£o afirmativas relacionadas a como voc√™ agiria naquela situa√ß√£o e voc√™ indicar√° seu n√≠vel de concord√¢ncia com cada uma delas, ‚Äúdiscordo totalmente‚Äù ao ‚Äúconcordo totalmente‚Äù.</p>
  <p>N√£o existe resposta certa ou errada.<br>
  O objetivo √© diagnosticar seu estilo, reconhecer suas for√ßas e identificar √°reas de desenvolvimento.</p>
  <p>Durante esse percurso, voc√™ explorar√° aspectos essenciais como:</p>
  <ul>
    <li>intelig√™ncia emocional,</li>
    <li>comunica√ß√£o assertiva,</li>
    <li>lideran√ßa emp√°tica,</li>
    <li>resili√™ncia,</li>
    <li>tomada de decis√£o em cen√°rios incertos,</li>
    <li>e o papel das soft skills no comportamento empreendedor.</li>
  </ul>
  <p><strong>Pronto(a) para avan√ßar e conhecer sua pr√≥pria forma de empreender?</strong></p>
  `;
  const html = `
    <section class="view-intro">
      <div class="intro">
        <h3>Como funciona</h3>
        ${texto}
      </div>
      <div class="footer">
        <div>
          <button class="btn secondary" id="btn-voltar-capa" type="button">Voltar</button>
        </div>
        <div>
          <button class="btn" id="btn-avancar-intro" type="button">Avan√ßar</button>
        </div>
      </div>
    </section>
  `;
  animateSwap(html);
}

/* ====== CEN√ÅRIO ====== */
function renderCenario(idx){
  const c = cenarios[idx];
  const progresso = Math.round(((idx)/cenarios.length)*100);
  const html = `
    <article class="view-cenario">
      <div class="hero">
        <img src="${c.imagem}" alt=""
             onerror="this.onerror=null;this.src='${IMG_FALLBACK}'" />
        <span class="badge">${idx+1} / ${cenarios.length}</span>
        <h2>${c.titulo}</h2>
      </div>
      <div class="content">
        <div class="narrativa">${c.narrativa}</div>

        <div class="afirmativas" role="group" aria-labelledby="afirmativas-${idx}">
          ${c.afirmativas.map((a,i)=>renderAfirmativa(idx,i,a,estado.respostas[idx][i])).join("")}
        </div>

        <div class="progress" aria-label="Progresso do jogo">
          <span style="width:${progresso}%"></span>
        </div>
      </div>

      <div class="footer">
        <div>
          <button class="btn secondary" ${idx===0?"disabled":""} id="btn-voltar" type="button">‚óÄ Voltar</button>
        </div>
        <div>
          <button class="btn secondary" id="btn-recomecar" type="button">Recome√ßar</button>
          ${idx<cenarios.length-1
            ? `<button class="btn avancar" ${(!isCenarioCompleto(idx)?"disabled":"")} id="btn-avancar" type="button">Avan√ßar ‚ñ∂</button>`
            : `<button class="btn warn finalizar" ${(!isCenarioCompleto(idx)?"disabled":"")} id="btn-finalizar" type="button">Finalizar &amp; Ver Feedback</button>`
          }
        </div>
      </div>
    </article>
  `;
  animateSwap(html);
}

function renderAfirmativa(ci, ai, afirm, valor){
  const scale = [1,2,3,4,5];
  const legend = {
    1:"Discordo totalmente", 2:"Discordo parcialmente",
    3:"Neutro", 4:"Concordo parcialmente", 5:"Concordo totalmente"
  };
  const groupName = `c${ci}a${ai}`;
  return `
    <div class="afirmativa">
      <p><strong>${ai+1}.</strong> ${afirm.texto}</p>
      <div class="likert">
        <div class="scale" role="radiogroup" aria-label="Escala de 1 a 5: ${afirm.texto}">
          ${scale.map(v=>`
            <div>
              <input id="${groupName}_${v}" type="radio" name="${groupName}" value="${v}"
                     data-ci="${ci}" data-ai="${ai}" aria-label="${v} - ${legend[v]}"
                     ${valor===v?"checked":""} />
              <label for="${groupName}_${v}">
                <span>${v}</span>
                <small>${legend[v]}</small>
              </label>
            </div>
          `).join("")}
        </div>
      </div>
    </div>
  `;
}

function isCenarioCompleto(idx){
  return estado.respostas[idx].every(v=>typeof v==="number" && v>=1 && v<=5);
}

/* ====== EVENTOS ====== */
root.addEventListener("change", (e)=>{
  const t = e.target;
  if(t && t.matches('input[type="radio"][data-ci][data-ai]')){
    const ci = Number(t.getAttribute("data-ci"));
    const ai = Number(t.getAttribute("data-ai"));
    const val = Number(t.value);
    if(!Number.isNaN(ci) && !Number.isNaN(ai) && !Number.isNaN(val)){
      if(!estado.respostas[ci]) estado.respostas[ci] = [null,null,null];
      estado.respostas[ci][ai] = val;
      salvarEstado();

      if(estado.etapa==='jogo' && ci===estado.atual){
        const btnAvancar = document.getElementById("btn-avancar");
        const btnFinalizar = document.getElementById("btn-finalizar");
        if(btnAvancar && isCenarioCompleto(ci)) btnAvancar.disabled = false;
        if(btnFinalizar && isCenarioCompleto(ci)) btnFinalizar.disabled = false;
      }

      // pode alterar a altura -> notifica o host
      requestAnimationFrame(sendHeightToParent);
    }
  }
});

root.addEventListener("click", (e) => {
  const btn = e.target.closest("button");
  if (!btn) return;

  switch (btn.id) {
    case "btn-comecar":
      estado.etapa = "intro";
      salvarEstado();
      renderIntro();
      break;

    case "btn-voltar-capa":
      estado.etapa = "capa";
      salvarEstado();
      renderCapa();
      break;

    case "btn-avancar-intro":
      estado.etapa = "jogo";
      estado.atual = 0;
      salvarEstado();
      renderCenario(0);
      break;

    case "btn-voltar":
      onPrev();
      break;

    case "btn-recomecar":
      onReset();
      break;

    case "btn-avancar":
      onNext();
      break;

    case "btn-finalizar":
      finalizar();
      break;

    default:
      break;
  }
});

function onPrev(){ if(estado.atual>0){ estado.atual--; salvarEstado(); renderCenario(estado.atual); } }
function onNext(){
  if(!isCenarioCompleto(estado.atual)) return;
  if(estado.atual<cenarios.length-1){ estado.atual++; salvarEstado(); renderCenario(estado.atual); }
}
function onReset(){
  if(!confirm("Tem certeza que deseja recome√ßar? Isso apagar√° suas respostas.")) return;
  estado = {
    etapa: 'capa',
    atual: 0,
    respostas: Array.from({length: cenarios.length}, () => [null, null, null]),
    finalizado: false,
    diag: null
  };
  salvarEstado();
  renderCapa();
}

/* ==========================
   Diagn√≥stico & Feedback
   ========================== */
function calcularDiagnostico(){
  const agg = {};
  Object.keys(objetivos).forEach(k=>agg[k] = { soma:0, qtd:0 });

  cenarios.forEach((c,ci)=>{
    c.afirmativas.forEach((a,ai)=>{
      const v = estado.respostas[ci][ai];
      if(typeof v!=="number") return;
      a.objetivos.forEach(obj=>{
        agg[obj].soma += v;
        agg[obj].qtd += 1;
      });
    });
  });

  const medias = {};
  Object.entries(agg).forEach(([k,{soma,qtd}])=>{
    medias[k] = qtd>0 ? Number((soma/qtd).toFixed(2)) : 0;
  });

  const tags = {};
  Object.entries(medias).forEach(([k, m])=>{
    if(m >= 4.2) tags[k] = "ok";
    else if(m >= 3.0) tags[k] = "mid";
    else tags[k] = "low";
  });

  const pontosFortes = Object.keys(medias).filter(k=>tags[k]==="ok");

  const oportunidadesDetalhadas = Object.keys(medias)
    .filter(k=>tags[k]==="low" || tags[k]==="mid")
    .map(k=>{
      const nivel = tags[k];
      const nivelLabel = nivel==="low" ? "Baixo" : "M√©dio";
      const texto = sugestaoPorNivel(Number(k), nivel);
      return { k, texto, nivel: nivelLabel };
    });

  return { medias, tags, pontosFortes, oportunidadesDetalhadas };
}

function sugestaoPorNivel(k, nivel) {
  const base = {
    1: {
      low: "Reforce pr√°ticas de vis√£o de valor: ao decidir, explicite como a a√ß√£o proposta cria valor para clientes e equipe. Registre hip√≥teses de impacto.",
      mid: "Conecte decis√µes ao valor gerado: explicite quem se beneficia e como medir resultados em ciclos curtos."
    },
    2: {
      low: "Pratique soft skills em micro-rotinas: feedbacks curtos semanais, reuni√µes de 15‚Äô com turnos de fala e acordos de conviv√™ncia.",
      mid: "Padronize rituais de comunica√ß√£o: check-ins de alinhamento e feedbacks com foco em comportamento observ√°vel."
    },
    3: {
      low: "Treine regula√ß√£o emocional: respira√ß√£o box, pausa de 90 segundos antes de responder e nomea√ß√£o de emo√ß√µes (‚Äòsinto X, porque Y‚Äô).",
      mid: "Antecipe gatilhos emocionais: prepare frases-ponte (‚Äòme d√™ 1 minuto para organizar a ideia‚Äô) e valide percep√ß√µes com a equipe."
    },
    4: {
      low: "Aprimore comunica√ß√£o emp√°tica: resuma o que ouviu antes de propor, use perguntas abertas e defina ‚Äòpr√≥ximos passos‚Äô expl√≠citos.",
      mid: "Use ESCUTA-RESUMO-ACORDO: sintetize pontos-chave e feche com um micro-plano registrado."
    },
    5: {
      low: "Estruture decis√µes sob press√£o: use uma matriz impacto √ó risco em 5 minutos; valide com 1 pessoa cr√≠tica antes de anunciar.",
      mid: "Crie um ‚Äòchecklist de 3 itens‚Äô para decis√µes r√°pidas: evid√™ncia, risco revers√≠vel e teste controlado."
    },
    6: {
      low: "Conecte soft skills √† inova√ß√£o: fa√ßa sess√µes de brainstorming com regras de escuta e documenta√ß√£o de aprendizados p√≥s-teste.",
      mid: "Ajuste o processo de ideia‚Üíteste: crit√©rios de aceita√ß√£o claros e retrospectivas com foco no aprendizado humano."
    },
    7: {
      low: "Aplique ferramentas de autoconhecimento: di√°rio de bordo, teste VIA ou Big Five e um plano de 30 dias com uma habilidade foco.",
      mid: "Escolha 1 soft skill foco por 2 semanas e acompanhe 3 indicadores de comportamento observ√°vel."
    }
  };
  return base[k]?.[nivel] ?? "Aprimore a consist√™ncia com pequenos experimentos semanais e retrospectivas breves.";
}

function finalizar(){
  if(!isCenarioCompleto(estado.atual)) return;
  estado.finalizado = true;
  estado.diag = calcularDiagnostico();
  estado.etapa = 'feedback';
  salvarEstado();
  renderFeedback();
}

function avaliarResumoGeral(d){
  const medias = Object.values(d.medias);
  const mediaGlobal = medias.reduce((a,b)=>a+b,0)/medias.length || 0;
  let cor = "equilibrada";
  if(mediaGlobal>=4.2) cor = "consistente e madura";
  else if(mediaGlobal<3) cor = "em desenvolvimento";
  return `Com base nas respostas aos cinco cen√°rios, foi poss√≠vel mapear sua atua√ß√£o frente a dilemas que envolvem empatia, comunica√ß√£o, resili√™ncia, √©tica e uso estrat√©gico de habilidades humanas. A consist√™ncia m√©dia das decis√µes (${mediaGlobal.toFixed(2)}/5) indica uma atua√ß√£o ${cor}, considerando as escalas de 1 (Discordo totalmente) a 5 (Concordo totalmente).`;
}

function renderFeedback(){
  const d = estado.diag || calcularDiagnostico();

  const linhasTabela = Object.keys(objetivos).map(k=>{
    const nivelKey = d.tags[k]; // ok | mid | low
    const nivelLabel = nivelKey==="ok"?"Alto":nivelKey==="low"?"Baixo":"M√©dio";
    const classe = nivelKey==="ok"?"ok":nivelKey==="low"?"low":"mid";
    return `
      <tr>
        <td>${k}. ${objetivos[k]}</td>
        <td><strong>${d.medias[k].toFixed(2)}</strong></td>
        <td><span class="lvl ${classe}">${nivelLabel}</span></td>
      </tr>
    `;
  }).join("");

  const pontosFortes = d.pontosFortes.length
    ? d.pontosFortes.map(k=>`<li>${objetivos[k]}</li>`).join("")
    : `<li>N√£o h√° indica√ß√µes</li>`;

  const oportunidades = d.oportunidadesDetalhadas.length
    ? d.oportunidadesDetalhadas.map(x=>`<li><strong>${x.k}. ${objetivos[x.k]} (${x.nivel})</strong>: ${x.texto}</li>`).join("")
    : `<li>N√£o h√° indica√ß√µes</li>`;

  const resumoGeral = avaliarResumoGeral(d);

  const html = `
    <section class="view-feedback">
      <div class="hero">
        <img src="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&w=1600&q=80"
             alt="" onerror="this.onerror=null;this.src='${IMG_FALLBACK}'" />
        <span class="badge">Relat√≥rio</span>
        <h2>üìä Relat√≥rio do Jogo: Miss√£o Empreendedora ‚Äì Decida com Coragem</h2>
      </div>

      <div class="feedback">
        <div class="stack">
          <div class="box">
            <h3>üéØ 1. Diagn√≥stico geral</h3>
            <p>${resumoGeral}</p>
            <table class="table-clean" aria-label="Tabela de crit√©rios com nota m√©dia e n√≠vel">
              <thead>
                <tr>
                  <th>Crit√©rio</th>
                  <th>Nota m√©dia</th>
                  <th>N√≠vel</th>
                </tr>
              </thead>
              <tbody>
                ${linhasTabela}
              </tbody>
            </table>
          </div>

          <div class="grid">
            <div class="box">
              <h3>‚úÖ 2. Pontos Fortes Identificados</h3>
              <ul>${pontosFortes}</ul>
            </div>
            <div class="box">
              <h3>üîç 3. Oportunidades de Desenvolvimento</h3>
              <ul>${oportunidades}</ul>
            </div>
          </div>

          <div class="box">
            <h3>üí° 4. Recomenda√ß√µes</h3>
            <p>O jogo <em>'Miss√£o Empreendedora'</em> foi desenvolvido para que voc√™ analise desafios reais relacionados ao comportamento empreendedor. Aproveite os feedbacks indicados como ponto departida para se desenvolver como um(a) profissional protagonista, √©tico(a) e inovador(a).</p>
            <p><strong>Recomenda√ß√µes finais:</strong></p>
            <ul class="checklist">
              <li>Experimente refazer o jogo buscando respostas menos intuitivas para explorar vieses e ampliar repert√≥rio.</li>
              <li>Refa√ßa o jogo selecionando alternativas diferentes para observar rea√ß√µes distintas.</li>
              <li>Acesse os materiais complementares na UDA para aprofundar seus conhecimentos.</li>
              <li>Registre suas percep√ß√µes e construa um plano pessoal de melhoria em soft skills.</li>
            </ul>
            <p>At√© a pr√≥xima!</p>
          </div>
        </div>
      </div>

      <div class="footer">
        <div>
          <button class="btn secondary" onclick="window.print()" type="button">üñ® Imprimir / Salvar PDF</button>
        </div>
        <div>
          <button class="btn" onclick="refazer()" type="button">üîÅ Refazer</button>
        </div>
      </div>
    </section>
  `;
  animateSwap(html);
}

function refazer(){ onReset(); }

/* Inicializa√ß√£o por etapa */
if(estado.etapa==='feedback'){ renderFeedback(); }
else if(estado.etapa==='jogo'){ renderCenario(estado.atual); }
else if(estado.etapa==='intro'){ renderIntro(); }
else { renderCapa(); }
</script>
</body>
</html>
